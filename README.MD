<div style="text-align: justify;">

# Техническое задание на создание отказоустойчивого майнинг-пула для нескольких криптовалют (Mining pool management system)

## Введение
### Цель документа

Настоящее техническое задание составляется с целью определения требований и условий для разработки, внедрения и эксплуатации майнинг-пула. Документ описывает ключевые аспекты проекта, включая функциональные и технические характеристики системы, требования к оборудованию и программному обеспечению, а также аспекты безопасности и масштабируемости.

Целью разработки майнинг-пула является обеспечение стабильной, безопасной и эффективной платформы для объединения вычислительных мощностей пользователей с целью коллективного добывания криптовалют. Это позволит участникам пула равномерно распределять награду за найденные блоки, обеспечивая справедливость, прозрачность и надежность процесса майнинга.

Документ предназначен для разработчиков, системных администраторов, специалистов по информационной безопасности и других заинтересованных сторон, участвующих в создании и эксплуатации майнинг-пула.


## Область применения

Разрабатываемый майнинг-пул предназначен для частных майнеров, профессиональных майнинг-ферм, а также предприятий, занимающихся добычей криптовалют. Он будет использоваться для коллективного майнинга цифровых активов с целью увеличения стабильности доходов и равномерного распределения вознаграждений между участниками.

Программный продукт применяется в среде распределенных вычислений. Доступ к пулу осуществляется через интернет, что позволяет использовать его в любой географической точке при наличии соответствующих вычислительных мощностей и подключения к сети.

Основными пользователями системы являются:

 - Владельцы частных и корпоративных майнинг-устройств (ASIC, GPU-фермы);
 - Операторы крупных  майнинг-центров;
 - Разработчики и администраторы, обеспечивающие техническую поддержку и эксплуатацию пула;
 - Финансовые аналитики и инвесторы, заинтересованные в прогнозировании доходности майнинга. 
 
Майнинг-пул ориентирован  на обеспечение высокой производительности, отказоустойчивости и безопасности, что делает его применимым, как для небольших групп энтузиастов, так и для крупных майнинговых объединений.


## 1. Общие требования
   ### 1.1 Цель разработки
   Целью разработки майнинг-пула является создание высокопроизводительной, надежной и безопасной платформы для коллективного майнинга криптовалют. Система должна обеспечить объединение вычислительных мощностей пользователей, оптимизацию распределения задач и справедливое распределение вознаграждений среди участников пула.

   Основные задачи, которые решает продукт:

   • **Повышение эффективности майнинга** – надежная, бесперебойная связь с пулом, снижение вероятности случайных потерь награды за счет совместного поиска блоков.  
   • **Обеспечение стабильного дохода** – участникам пула предоставляются разные модели начисления вознаграждений за их вклад в работу пула.  
   • **Масштабируемость и отказоустойчивость** – система должна поддерживать большое количество подключенных пользователей и гарантировать бесперебойную работу.  
   • **Безопасность** – защищенные каналы обмена данными (TLS), обеспечение целостности данных, прозрачные и надежные механизмы платежей.  
   • **Простота использования** – удобный интерфейс и поддержка различных устройств (ASIC, GPU-фермы, CPU).  

   Разработка майнинг-пула направлена на создание конкурентоспособного решения, способного работать в условиях высокой нагрузки, соблюдая современные требования к производительности, безопасности и прозрачности расчетов.

### 1.2 Пользователи системы
Система майнинг-пула предусматривает несколько категорий пользователей, каждая из которых обладает различными уровнями доступа и функциональными возможностями:

**Администраторы** – управляют работой пула, обеспечивают его техническое обслуживание и безопасность.

- Настройка и мониторинг серверов.
- Управление пользователями и правами доступа.
- Анализ производительности и логирование событий.
- Мониторинг работы майнинговых сервисов в реальном времени.
- Корректировка параметров работы майнинговых серверов.
- Обновление программного обеспечения и реализация мер безопасности.

**Майнеры (конечные пользователи)** – владельцы вычислительных мощностей, участвующие в майнинге.
- Подключение оборудования (ASIC, GPU-фермы, CPU).
- Отслеживание статистики работы (хешрейт, доходность, выполненные шары).
- Получение вознаграждений в соответствии с выбранной моделью выплат.
- Настройка параметров майнинга (выбор алгоритма, кошелька, рабочих узлов).

**Финансовые пользователи** (инвесторы, бухгалтеры, аналитики) – анализируют доходность и управляют финансами.

- Мониторинг доходов и расходов пула.
- Управление выплатами и учет транзакций.
- Анализ эффективности работы оборудования.

**Гости** (неавторизованные пользователи) – могут просматривать общедоступную информацию о пуле.

- Ознакомление с условиями работы пула.
- Просмотр статистики и публичных данных (например, общий хешрейт пула, последние найденные блоки).
- Регистрация и создание учетной записи для пользования сервисами, требующими авторизации.

Каждая категория пользователей имеет определенные права доступа и инструменты для эффективного взаимодействия с системой, что обеспечивает безопасность, удобство и прозрачность работы пула.


### 1.3 Предназначение продукта
Разрабатываемый майнинг-пул предназначен для объединения вычислительных мощностей пользователей с целью совместной добычи криптовалют. Он обеспечивает равномерное распределение награды за найденные блоки среди участников, пропорционально их вкладу, что делает майнинг более предсказуемым и стабильным.

Основные проблемы, которые решает продукт:

- **Нестабильность индивидуального майнинга – одиночные майнеры сталкиваются с высокой волатильностью доходов, поскольку вероятность нахождения блока мала. Пул решает эту проблему, распределяя награды среди всех участников.
• Оптимизация вычислительных мощностей – за счет эффективного распределения задач между подключенными устройствами повышается общая производительность майнинга.
• Упрощение процесса майнинга – пользователи получают удобный инструмент для мониторинга и настройки своего оборудования без необходимости глубоко разбираться в технических аспектах блокчейна.
• Обеспечение безопасности и прозрачности – система защищена от мошенничества и манипуляций с выплатами, обеспечивая честное распределение доходов.
Как будет использоваться продукт:
1. Пользователь регистрируется в системе (если необходимо для использования некоторых услуг), подключает свое оборудование.
2. Система распределяет задачи среди участников и агрегирует результаты.
3. Найденные блоки подтверждаются в блокчейне, и вознаграждение делится согласно установленной схеме распределения наград.
4. Пользователь может отслеживать свою статистику и получать выплаты на указанный кошелек.
Таким образом, майнинг-пул повышает рентабельность и доступность майнинга, позволяя как частным майнерам, так и крупным фермам эффективно использовать свои ресурсы.

### 1.4 Область применения
Майнинг-пул будет использоваться в различных условиях, где есть доступ к вычислительным мощностям и интернет-соединению. Его основная область применения включает в себя:

1. **Майнинг-фермы** – крупные объекты с высокоскоростными вычислительными мощностями, ориентированные на добычу криптовалют. Пул обеспечит эффективное объединение мощностей разных фермеров и оптимизацию их работы.
2. **Частные майнеры** – индивидуальные пользователи, которые используют свои вычислительные ресурсы (например, ASIC-устройства или GPU-фермы) для участия в коллективном майнинге.
3. **Дата-центры** – профессиональные компании, предоставляющие хостинг и облачные вычисления, которые могут использовать пул для объединения своих ресурсов и более эффективного майнинга.
4. **Криптовалютные стартапы и исследовательские проекты** – организации, которые могут использовать майнинг-пул как средство для тестирования и разработки новых алгоритмов и технологий.

Майнинг-пул может функционировать в условиях постоянного интернет-соединения и в любом месте, где доступна соответствующая вычислительная инфраструктура (серверы, майнинговые установки, дата-центры). Продукт также можно использовать в разных географических регионах, обеспечивая доступ к участникам по всему миру.

Кроме того, продукт будет востребован в условиях активного развития криптовалютных рынков, что предполагает его использование как для крупных коммерческих проектов, так и для отдельных пользователей, заинтересованных в стабилизации и увеличении своих доходов от майнинга.

### 1.5 Описание системы
Майнинг-пул представляет собой распределенную вычислительную систему, предназначенную для объединения вычислительных мощностей участников с целью совместного майнинга криптовалют. Основной задачей системы является эффективное распределение работы между подключенными участниками, а также справедливое распределение вознаграждений за выполненные вычисления.

В пуле используется Proof of Work (PoW) алгоритм консенсуса для подтверждения транзакций и защиты сети от атак. Майнеры (участники сети) выполняют сложные вычисления, чтобы доказать, что они потратили определённые вычислительные ресурсы на обработку данных.

## 2. Архитектура системы
   ### 2.1 Общая концепция архитектуры
   - Проект должен быть построен с использованием микросервисного подхода.  
   - Высоконагруженные узлы, отвечающие за вычисления должны быть масштабируемыми – при росте нагрузки иметь механизм для быстрого добавления мощностей в полуавтоматическом, а в перспективе и в полностью автоматическом режиме.
   - Компоненты системы должны быть отказоустойчивыми – при выходе из строя вычислительного узла поток запросов должен перенаправляться на рабочие узлы. Данные должны храниться в отказоустойчивых кластерах, чтобы при выходе из строя одного из узлов кластера данные не были потеряны.
   - Взаимодействие между микросервисами, а также запросы от пользователей должно вестись по защищенным протоколам (TLS, JWT токены)
   - Микросервисный подход в выборе архитектуры выбран по следующим причинам:
    
     - Специфика майнинга изначально подразумевает размещение серверов в нескольких географических зонах. Каждая криптовалюта имеет свою специфику – значит для каждой криптовалюты нужно разработать свой микросервис по решению задач генерации заданий, приему и проверки решений от майнеров.
     - Мы изначально планируем размещать сервера в трех географических зонах (Европа, Азия, Америка), то есть на каждую криптовалюту необходимо минимум три сервера, а при, например, пяти криптовалютах – 15 серверов.
     - В зависимости от метода вычисления вознаграждений (а их запланировано минимум три) в рамках одной криптовалюты будет несколько реализаций алгоритма подсчета наград. Для всех криптовалют методы вычисления наград работают в принципе одинаково (возможно с мелкими вариациями), поэтому имеет смысл вынести функционал вычисления вознаграждений в отдельный микросервис.
     - Три географические зоны, пять криптовалют, три метода вычисления вознаграждений дает 45 отдельных конфигурационных файлов, что влечет за собой необходимость реализации механизма централизованного изменения конфигураций.
     - При таком количестве серверов очень трудно следить за актуальностью адресов и портов для каждого микросервиса – необходима какая-то служба обнаружения сервисов (Service Discovery).
     - От такого количества серверов постоянно идет огромный поток данных, которые нужно где-то агрегировать, а потом строить различные выборки по накопленным данным. Из-за потенциально большого количества данных на добавление, а также для обработки миллионов записей в запросе традиционная реляционная база данных не подходит. Поэтому имеет смысл такие данные хранить в аналитической базе данных (ClickHouse) и вынести функционал работы с ней в отдельный микросервис.
     - Также выносим данные по майнерам и воркерам в отдельный микросервис. Он будет использоваться как справочник для остальных микросервисов, а также будет хранить актуальные характеристики работы воркеров и отдавать их пользователям.
     - Серверов для майнинга отдельной криптовалюты может быть много, но сервис платежей по этой криптовалюте нужен только один. Поэтому его тоже выносим в отдельный микросервис. К тому же этот сервис не подразумевает высоких нагрузок, поэтому для его работы можно использовать слабый сервер или даже можно разместить эту службу на одном сервере с другими микросервисами.
     - Также логично выделить отдельный микросервис для рассылки уведомлений о происходящих в системе событиях. Эти уведомления могут рассылаться как пользователям, так и администраторам. Уведомления могут иметь как штатный характер – для отображения текущих параметров работы воркеров, найденных шарах, блоках и т.д., так и алерты для администратора при возникновении критических событий: аномальная нагрузка, падение сервиса, заканчивающееся место на диске и тому подобное.
     - Работы по регистрации и авторизации пользователей также выносим в отдельный микросервис.
     - Для управления входящими запросами к микросервисам в этой распределённой системе необходим отдельным микросервис API Gateway. Он выполняет роль единой точки входа для клиентов (мобильных приложений, веб-приложений, других сервисов) и распределяет запросы между бэкенд-сервисами. Может использоваться для балансировки нагрузки, аутентификации  и авторизации, кеширования, мониторинга и логирования, огранияения количества запросов (Rate Limiter), а также для маршрутизации и агрегирования запросов к нужным микросервисам.


### 2.2 Основные принципы построения микросервисной архитектуры проекта
**Декомпозиция на независимые сервисы**

- Каждый микросервис выполняет одну конкретную бизнес-задачу (принцип единственной ответственности).
- Разделение по доменным областям (DDD – Domain-Driven Design).

**Слабая связанность и автономность**
- Каждый сервис разрабатывается, разворачивается и масштабируется независимо от других.
- Минимизация зависимостей между сервисами.

**Обмен данными через API**
- Взаимодействие микросервисов происходит через REST API, gRPC, WebSockets, а также через очереди сообщений (Kafka, RabbitMQ).
- Использование стандартных протоколов (JSON, Protobuf).

**Разделенные хранилища данных**
- Каждый микросервис управляет своей собственной базой данных (NoSQL, SQL).
- Исключается прямая зависимость между сервисами через общую БД.

**Автоматизированное развертывание и оркестрация**
- Ansible для простой и удобной автоматизации без сложных инструментов.
- Использование контейнеризации (Docker, в перспективе Kubernetes).
- CI/CD-пайплайны для автоматического деплоя и обновления сервисов (Gitlab CI).

**Масштабируемость и отказоустойчивость**
- Возможность горизонтального масштабирования отдельных сервисов (сервера генерации заданий и проверки решений).
- Отказоустойчивые кластеры баз данных (PostgreSQL, ClickHouse, etcd) и очередей сообщений (Kafka, RabbitMQ)

**Мониторинг и логирование**
- Централизованный мониторинг (Prometheus, Grafana).
- Логирование (EFK Stack – Elasticsearch, Fluentbit, Kibana)
- Трассировка запросов (OpenTelemetry, Otel Collector, Grafana Tempo, Grafana).

**Безопасность и аутентификация**
- Использование API Gateway для маршрутизации и защиты сервисов.
- Аутентификация через JWT.
- Использование защищенных TLS соединений


### 2.3 Логическая архитектура

Очень упрощенная схема логической архитектуры выглядит как на рисунке ниже:

![Логическая архитектура](images/logic-scheme.png)

Стрелками обозначено направление движения данных.

Майнер подключается к микросервису **Share checker** получает задание и отправляет решение (шару).  Далее данные шар накапливаются в **Share processor** откуда могут быть запрошены пользователем через **API Gateway** или же быть использованы при подсчете вознаграждения в **Miners rewards** после нахождения блока.

После подтверждения блока служба **Miners rewards** обменивается данными с **Miners payouts** для начисления средств на балансы майнеров. При достижении порогового значения служба **Miners rewards** производит выплаты майнерам.

Все службы могут генерировать уведомления, которые с помощью **Notification manager** рассылаются нужным адресатам.

Также для некоторого функционала может быть необходима авторизация пользователя – для этих целей есть служба **User manager**.










</div>