# Общая схема и технологии
## Общая упрощенная схема
![Логическая архитектура](images/logic-scheme.png)

**Miner** - оборудование и программа с помощью который пользователь осуществляет добычу криптовалюты.

**Telegram client** - интерфейс телеграм бота для взаимодействия пользователя с системой.

**Frontend** - пользовательский Web интерфейс (сайт в виде SPA приложения).

**Telegram miner bot** - микросервис реализующий Telegram бот для наблюдению за майнингом. 

**API Gateway** - микросервис для обработки HTTP/HTTPS запросов от клиентов (пользователи и администраторы) и распределения их между бэкенд микросервисами.

**Shares checker** - микросервис, разработанный под конкретную криптовалюту, получает задачу из блокчейн ноды, дробит ее на подзадачи и распределяет их между майнерами. Получает от майнеров решения, проверяет их и передает в микросервис обработки и хранения.

**Shares processor** - микросервис для получения потока решений от майнеров, сохранение их в базу, формирование агрегированных данных для пользователей и для формирования массива данных для расчета вознаграждений.

**Miners processor** - микросервис для работы с данными майнеров и воркеров. Заведение новых майнеров и воркеров в базе, выдача данных по ним по внешним запросам. Хранение текущих параметров работы майнеров/воркеров.

**Miners rewards** - микросервис для обработки найденных блоков, вычисления и хранения вознаграждений за блок.

**Miners payouts** - микросервис для осуществления выплат. Отдельная разработка для каждой криптовалюты.

**Notification manager** - микросервис для рассылки уведомлений.

**User manager** - микросервис для некоторых действий (реферальная программа, дополнительный функционал) где требуется регистрация и авторизация пользователей.

## Используемые технологии (перечисление)

**Языки программирования:** Golang, Node.js, Javascript (Vue.js).

**Технологии:** Docker, YAML, Ansible, CGO механизм в Golang, TLS, JWT, REST, Redis, Websocket, JSON, gRPC, Protocol Buffers (Protobuf), Gitlab CI/CD, Apache ZooKeeper, VDS, Ubuntu, HAProxy, pgBouncer, Patroni, Nginx, Stratum, Blockchain API, Telegram Bot API, Git, GitLab

**Очереди:** Apache Kafka, UI for Kafka, RabbitMQ

**Базы данных в кластерах:** PostgreSQL, Clickhouse, etcd, etcd-keeper

**Observability:** Elasticsearch, Fluentbit, Kibana, Prometheus, OpenTelemetry, Otel Collector, Grafana Tempo, Grafana


# Архитектура проекта

![Общая схема](images/global-structure.png)

В высоком разрешении на [этой странице](https://laradrom.ru/struktura-i-komponenty-majning-pula/).

Пояснения к условным обозначениям:

- **Пунктирной рамкой** очерчены логические компоненты системы (микросервисы).
- **Шестиугольниками** разных цветов обозначены непосредственно бинарники микросервисов (Golang программы) – то, что собственно и реализует программист.
- **Стрелками** обозначены связи между компонентами: запросы, команды, потоки данных.
- **Значки внутри шестиугольников** обозначают внутренние подсистемы в программе, отвечающие за определенный функционал:
    - **SD** – Service Discovery. Все микросервисы пользуются механизмом обнаружения сервисов, то есть других микросервисов с которыми они взаимодействуют.
    - **CMS** – Config Management System. Все микросервисы загружают свою конфигурацию из отказоустоучивого кластера etcd.
    - **синий круг** – микросервис пишет логи в систему логирования
    - **красный круг** – микросервис пишет метрики в систему сбора метрик
    - **зеленый круг** – микросервис пишет трейсы систему в сбора, хранения и запроса трейсов
    - **wallets cache** – кеш данных майнеров и воркеров в оперативной памяти программы

- **Значок монитора** – означает пользовательский интерфейс.
- **Цилиндр** – база данных. Подразумевается отказоустойчивый кластер.
- **Подписанные прямоугольники в цилиндрах** – названия основных таблиц в базе.
- **Цилиндр на боку** (труба) – очередь сообщений.
- **Подписанные прямоугольники в цилиндрах на боку** – названия топиков или очередей.
- **Fluentbit** – агент сбора логов.
